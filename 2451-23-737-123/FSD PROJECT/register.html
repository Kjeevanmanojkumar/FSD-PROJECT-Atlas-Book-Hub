<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Create your Atlas Book Hub account" />
  <title>Atlas Book Hub ‚Äî Register | Create Your Account</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header & Navigation -->
  <header class="top-frame">
    <div class="top-left">
      <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
        <rect rx="8" width="48" height="48" fill="#0066ff" />
        <path fill="white" d="M14 12h20v24H14zm2 2v20h16V14z" />
      </svg>
      <div class="site-title">
        <div class="name">Atlas Book Hub</div>
        <div class="subtitle">Educational Excellence Through Knowledge</div>
      </div>
    </div>
    <nav class="top-nav">
      <a href="auth.html">Back</a>
      <a href="catalogue.html">Catalogue</a>
      <a href="register.html" class="active">Register</a>
      <a href="cart.html" class="cart-link">Cart <span id="cart-count-top" class="badge">0</span></a>
      <span id="currency-display" style="margin-left: 20px; font-size: 12px; color: var(--muted);">Loading...</span>
    </nav>
  </header>

  <!-- Registration Form -->
  <main class="page register-page">
    <div class="register-container">
      <h2>Create Your Account</h2>
      <p class="section-desc">Join thousands of students accessing premium educational materials</p>

      <form id="registerForm" method="post" action="register.php" novalidate>
        <!-- Location Display -->
        <div style="margin-bottom:15px; padding:10px; background:var(--bg-light); border-radius:6px; font-size:13px; border-left:3px solid var(--primary);">
          üåç Detected location: <span id="register-detected-country" style="font-weight:600; color:var(--primary);">Detecting...</span>
          <input type="hidden" name="user_country" id="register-user-country" />
        </div>

        <!-- Personal Information -->
        <section class="form-section">
          <h4>Personal Information</h4>
          
          <label for="name">Full Name *</label>
          <input 
            id="name" 
            name="name" 
            type="text" 
            placeholder="Enter your full name"
            required 
            autocomplete="name"
          />

          <div class="form-row">
            <div style="flex: 1;">
              <label for="email">Email Address *</label>
              <input 
                id="email" 
                name="email" 
                type="email" 
                placeholder="your.email@example.com"
                required 
                autocomplete="email"
              />
            </div>
            <div style="flex: 1;">
              <label for="phone">Phone Number *</label>
              <input 
                id="phone" 
                name="phone" 
                type="tel" 
                placeholder="10-digit number"
                required 
                autocomplete="tel"
              />
            </div>
          </div>

          <div class="form-row">
            <div style="flex: 1;">
              <label for="password">Password *</label>
              <input 
                id="password" 
                name="password" 
                type="password" 
                placeholder="Minimum 6 characters"
                required 
                autocomplete="new-password"
              />
            </div>
            <div style="flex: 1;">
              <label for="confirm-password">Confirm Password *</label>
              <input 
                id="confirm-password" 
                name="confirm-password" 
                type="password" 
                placeholder="Re-enter password"
                required 
                autocomplete="new-password"
              />
            </div>
          </div>
        </section>

        <!-- Gender & Date of Birth -->
        <section class="form-section">
          <h4>Additional Details</h4>
          
          <fieldset>
            <legend>Gender *</legend>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="sex" value="M" required />
                Male
              </label>
              <label class="radio-label">
                <input type="radio" name="sex" value="F" />
                Female
              </label>
              <label class="radio-label">
                <input type="radio" name="sex" value="O" />
                Other
              </label>
            </div>
          </fieldset>

          <label>Date of Birth *</label>
          <div class="form-row dob-row">
            <select id="dob-day" name="dob-day" required style="flex: 1;">
              <option value="">Day</option>
            </select>
            <select id="dob-month" name="dob-month" required style="flex: 1;">
              <option value="">Month</option>
            </select>
            <select id="dob-year" name="dob-year" required style="flex: 1;">
              <option value="">Year</option>
            </select>
          </div>
        </section>

        <!-- Languages & Address -->
        <section class="form-section">
          <h4>Languages & Location</h4>
          
          <fieldset>
            <legend>Languages Known *</legend>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="lang[]" value="English" />
                English
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="lang[]" value="Telugu" />
                Telugu
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="lang[]" value="Hindi" />
                Hindi
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="lang[]" value="Tamil" />
                Tamil
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="lang[]" value="Kannada" />
                Kannada
              </label>
            </div>
          </fieldset>

          <label for="address">Residential Address *</label>
          <textarea 
            id="address" 
            name="address" 
            rows="3" 
            placeholder="Enter your complete postal address"
            required
          ></textarea>
        </section>

        <!-- OTP Verification Section -->
        <section class="form-section" id="otp-section" style="display: none; background: var(--bg-light); padding: 16px; border-radius: 8px; border: 2px solid var(--primary);">
          <h4>üì± Verify Your Account</h4>
          <p style="color: var(--muted); font-size: 13px; margin-bottom: 12px;">Choose how you'd like to receive your OTP</p>
          
          <!-- OTP Method Selection -->
          <div class="form-row" id="otp-method-select">
            <button type="button" class="btn btn-ghost" id="otp-email-btn" style="flex: 1; border: 2px solid var(--primary); margin-right: 8px;">
              üìß Email OTP
            </button>
            <button type="button" class="btn btn-ghost" id="otp-sms-btn" style="flex: 1; border: 2px solid var(--primary);">
              üì≤ SMS OTP
            </button>
          </div>
          
          <!-- OTP Input Fields -->
          <div id="otp-input-section" style="display: none; margin-top: 16px;">
            <label for="otp-code">Enter OTP Code *</label>
            <input 
              id="otp-code" 
              type="text" 
              placeholder="Enter 6-digit OTP" 
              maxlength="6"
              inputmode="numeric"
              pattern="[0-9]{6}"
              style="font-size: 18px; letter-spacing: 8px; text-align: center; font-weight: bold;"
            />
            
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Expires in: <span id="otp-timer">10:00</span>
            </div>
            
            <div id="otp-message" class="otp-message" style="display: none; margin-top: 12px; padding: 8px; border-radius: 4px; font-size: 13px;"></div>
            
            <div style="margin-top: 12px;">
              <button type="button" id="otp-verify-btn" class="btn btn-primary" style="width: 100%;">Verify OTP</button>
            </div>
            
            <div style="margin-top: 8px; text-align: center;">
              <button type="button" id="otp-resend-btn" class="btn btn-ghost" style="font-size: 12px;">Didn't receive? Resend OTP</button>
            </div>
          </div>
          
          <input type="hidden" id="otp-verified" value="false" />
        </section>

        <!-- Terms & Conditions -->
        <div class="terms-section">
          <label class="checkbox-label">
            <input type="checkbox" name="terms" required />
            I agree to the <a href="#terms">Terms & Conditions</a> and <a href="#privacy">Privacy Policy</a>
          </label>
        </div>

        <!-- Form Actions -->
        <div class="form-row form-actions">
          <button id="registerSubmit" class="btn btn-primary btn-large" type="submit">Create Account</button>
          <button type="reset" class="btn btn-ghost btn-large">Clear Form</button>
        </div>

        <!-- Message -->
        <div id="registerMsg" class="error" aria-live="polite"></div>
      </form>

      <div class="auth-divider">
        <span>Already have an account?</span>
      </div>

      <a href="login.html" class="btn btn-ghost btn-large" style="width: 100%; text-align: center; margin-top: 12px;">Sign In</a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h5>About Us</h5>
        <p>Atlas Book Hub is committed to providing quality educational resources to engineering students.</p>
      </div>
      <div class="footer-section">
        <h5>Quick Links</h5>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="catalogue.html">Catalogue</a></li>
          <li><a href="login.html">Login</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h5>Contact</h5>
        <p>Email: support@atlasbookhub.in<br />Phone: +91-8885-5555</p>
      </div>
    </div>
    <div class="footer-bottom">¬© 2025 Atlas Book Hub. All rights reserved.</div>
  </footer>

  <script src="app.js"></script>
  <script>
    // Detect user country and currency on page load
    document.addEventListener('DOMContentLoaded', () => {
      detectUserCountry();
      updateRegisterLocationDisplay();
      initRegistrationValidation();
      initOTPSystem();
    });

    // Initialize OTP System
    function initOTPSystem() {
      const emailBtn = document.getElementById('otp-email-btn');
      const smsBtn = document.getElementById('otp-sms-btn');
      const otpVerifyBtn = document.getElementById('otp-verify-btn');
      const otpResendBtn = document.getElementById('otp-resend-btn');
      const registerForm = document.getElementById('registerForm');
      const emailInput = document.getElementById('email');
      const phoneInput = document.getElementById('phone');
      
      // Show OTP section only after entering valid email and phone
      function showOTPSection() {
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();
        const otpSection = document.getElementById('otp-section');
        
        // Only show OTP if both email and phone are valid
        if (email && /^\S+@\S+\.\S+$/.test(email) && phone && /^\d{10}$/.test(phone)) {
          otpSection.style.display = 'block';
          otpSection.classList.add('anim-fade-up');
        } else {
          otpSection.style.display = 'none';
        }
      }
      
      emailInput.addEventListener('blur', showOTPSection);
      emailInput.addEventListener('input', showOTPSection);
      phoneInput.addEventListener('blur', showOTPSection);
      phoneInput.addEventListener('input', showOTPSection);
      
      // Email OTP button
      emailBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const email = emailInput.value.trim();
        
        if (!email) {
          alert('Please enter email first');
          return;
        }
        
        emailBtn.classList.add('active');
        smsBtn.classList.remove('active');
        document.getElementById('otp-input-section').style.display = 'block';
        
        sendOTPViaEmail(email);
      });
      
      // SMS OTP button
      smsBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const phone = phoneInput.value.trim();
        
        if (!phone || !/^\d{10}$/.test(phone)) {
          alert('Please enter valid 10-digit phone number');
          return;
        }
        
        smsBtn.classList.add('active');
        emailBtn.classList.remove('active');
        document.getElementById('otp-input-section').style.display = 'block';
        
        sendOTPViaSMS(phone);
      });
      
      // Verify OTP button
      otpVerifyBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const enteredOTP = document.getElementById('otp-code').value.trim();
        
        if (enteredOTP.length !== 6) {
          showOTPMessage('Please enter 6-digit OTP', 'error');
          return;
        }
        
        if (verifyOTP(enteredOTP)) {
          document.getElementById('otp-verified').value = 'true';
          document.getElementById('otp-section').style.backgroundColor = '#d4edda';
          otpVerifyBtn.disabled = true;
          otpVerifyBtn.textContent = '‚úì Verified';
        }
      });
      
      // Resend OTP button
      otpResendBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        if (emailBtn.classList.contains('active')) {
          emailBtn.click();
        } else if (smsBtn.classList.contains('active')) {
          smsBtn.click();
        } else {
          alert('Please select OTP method first');
        }
      });
      
      // Prevent form submit if OTP not verified
      registerForm.addEventListener('submit', function(e) {
        const otpVerified = document.getElementById('otp-verified').value === 'true';
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();
        const name = document.getElementById('name').value.trim();
        
        // Show OTP section if email and phone are filled
        if (email && phone) {
          if (!otpVerified) {
            e.preventDefault();
            alert('Please verify OTP before creating account');
            document.getElementById('otp-section').scrollIntoView({ behavior: 'smooth' });
            return;
          }
          
          // OTP is verified, proceed with registration
          e.preventDefault();
          
          // Set user as authenticated
          setUserAuthenticated();
          localStorage.setItem('user_email', email);
          localStorage.setItem('user_name', name);
          localStorage.setItem('register_location', userCountry);
          
          // Show success message
          alert('‚úì Registration successful! Welcome to Atlas Book Hub!');
          
          // Redirect to home page
          window.location.href = 'index.html';
        }
      });
    }
  </script>
</body>
</html>
